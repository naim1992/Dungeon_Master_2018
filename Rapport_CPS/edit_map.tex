
\begin{tabular}{rl}
\textbf{Service:}&	EditMap \textbf{refine} Map\\
\textbf{Types:}&	bool, int, Cell\\
\textbf{Observators:} &
isReachable: $[EditMap] \times int \times int \times int \times int \rightarrow bool$\\
& \quad\textbf{pre} isReachable(M,x1,y1,x2,y2) \textbf{requires} CellNature(M,x1,y1) $\neq$ WLL \textbf{and} CellNature(M,x2,y2) $\neq$ WLL\\
&
isReady: [EditMap] $\rightarrow$ bool\\
\textbf{Constructors:} & $\emptyset$\\
\textbf{Operators:} &
SetNature: [EditMap]$\times$int$\times$int$\times$Cell $\rightarrow$ [EditMap]\\
& \quad\textbf{pre} SetNature(M,x,y) \textbf{requires} 0$\leq$x<Width(M) \textbf{and} 0$\leq$y< Height(M)\\


\textbf{Observations:}\\

[\textbf{Invariants}]: & isReachable(M,x1,y1,x2,y2) = \textbf{exists} P \textbf{in} Array[int,int], P[0] = (x1,y1)\\&
\quad\textbf{and} P[size(P)-1] = (x2,y2)\\
& 
\quad\textbf{and} \textbf{forall} i \textbf{in} [1;size(P)-1], (P[i-1]=(u,v) \textbf{and} P[i]=(s,t)) \textbf{implies} (u-s$ )^2$ + (v-t$)^2$ = 1\\
&
\quad\textbf{and} \textbf{forall} i in [1;size(P)-2], P[i-1]=(u,v) \textbf{implies} CellNature(M,u,v) $\neq$ WLL\\
&
isReady(M) = \textbf{exists} xi,yi,xo,yo \textbf{in} $int^4$ ,
CellNature(M,xi,yi) = IN \\
&
\quad\textbf{and} CellNature(M,xi,yi) = OUT\\
&
\quad\textbf{and} isReachable(M,xi,yi,xo,yo)\\
&
\quad\textbf{and} forall x,y in int 2 , x $\neq$ xi or y $\neq$ yi \textbf{implies} CellNature(M,x,y) $\neq$ IN\\
&
\quad\textbf{and} \textbf{forall} x,y in int 2 , x $\neq$ xo or y $\neq$ yo \textbf{implies} CellNature(M,x,y) $\neq$ OUT\\
&
\quad\textbf{forall} x,y in int, CellNature(M,x,y) $\in \{ DNO, DNC\}$\\
&
\quad\quad\textbf{implies} CellNature(M,x+1,y) = CellNature(M,x-1,y) = EMP\\
&
\quad \textbf{and} CellNature(M,x,y-1) = CellNature(M,x,y+1) = WLL\\
&
\quad\textbf{forall} x,y in int, CellNature(M,x,y) $\in \{ DWO, DWC\}$ \\
& \quad\quad\textbf{implies} CellNature(M,x+1,y) = CellNature(M,x-1,y) = WLL \\
&
\quad\textbf{and} CellNature(M,x,y-1) = CellNature(M,x,y+1) = EMP\\

[\textbf{SetNature}]: &
CellNature(SetNature(M,x,y,Na),x,y) = Na\\
& \quad\textbf{forall} u,v in $int^2$ , u $\neq$ x or v $\neq$ y\\
&
\quad\quad \textbf{implies} CellNature(SetNature(M,x,y),u,v) = CellNature(M,u,v)\\
\end{tabular}
